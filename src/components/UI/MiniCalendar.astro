---
/**
 * MiniCalendar - Compact calendar view with clickable event indicators
 * Shows month view with dots for days that have events
 * Click dots to see event titles with links
 */
import { DAY_ABBREVIATIONS, type EventsByDate } from '../../utils/calendarUtils';

interface Props {
  eventsByDate: EventsByDate;
  class?: string;
}

const { eventsByDate, class: className } = Astro.props;
---

<div class={`mini-calendar ${className || ''}`} data-events={JSON.stringify(eventsByDate || {})}>
  <!-- Header with navigation -->
  <div class="flex items-center justify-between mb-3">
    <button type="button" class="cal-prev p-1 hover:bg-gray-100 rounded transition-colors" aria-label="Previous month">
      <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
    </button>
    <h3 class="cal-month-year text-sm font-semibold text-gray-900"></h3>
    <button type="button" class="cal-next p-1 hover:bg-gray-100 rounded transition-colors" aria-label="Next month">
      <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    </button>
  </div>

  <!-- Day headers -->
  <div class="grid grid-cols-7 gap-1 text-center text-xs mb-1">
    {DAY_ABBREVIATIONS.map(day => (
      <div class="text-gray-500 font-medium">{day}</div>
    ))}
  </div>

  <!-- Calendar days (populated by JavaScript) -->
  <div class="cal-days grid grid-cols-7 gap-1 text-center text-sm"></div>

  <!-- Tooltip for event details -->
  <div class="cal-tooltip hidden absolute z-50 bg-white border border-gray-200 rounded-lg shadow-lg p-3 max-w-xs">
    <div class="cal-tooltip-content"></div>
  </div>

  <!-- Footer with today button and legend -->
  <div class="mt-3 pt-3 border-t border-gray-100 flex items-center justify-between">
    <button type="button" class="cal-today text-xs text-primary-600 hover:text-primary-700 font-medium">
      Today
    </button>
    <div class="flex items-center gap-1 text-xs text-gray-500">
      <span class="w-1.5 h-1.5 rounded-full bg-primary-500"></span>
      <span>Event</span>
    </div>
  </div>
</div>

<style is:global>
  /* Calendar container */
  .mini-calendar {
    position: relative;
  }

  /* Day cells */
  .cal-day {
    width: 28px;
    height: 32px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding-top: 2px;
    border-radius: 4px;
  }

  .cal-day-number {
    line-height: 1.2;
    font-size: 0.8rem;
  }

  .cal-day.other-month .cal-day-number {
    color: #d1d5db;
  }

  .cal-day.today .cal-day-number {
    background-color: #2563eb;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }

  /* Event dots */
  .cal-dots {
    display: flex;
    gap: 2px;
    margin-top: 2px;
    height: 6px;
    align-items: center;
    cursor: pointer;
  }

  .cal-dots:hover .cal-dot {
    transform: scale(1.3);
  }

  .cal-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background-color: #3b82f6;
    transition: transform 0.15s ease;
  }

  .cal-dot.dot-secondary {
    background-color: #60a5fa;
  }

  .cal-dot.dot-tertiary {
    background-color: #93c5fd;
  }

  /* Tooltip */
  .cal-tooltip {
    min-width: 180px;
  }

  .cal-tooltip-event {
    padding: 6px 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .cal-tooltip-event:last-child {
    border-bottom: none;
  }

  .cal-tooltip-event a {
    color: #2563eb;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.875rem;
    display: block;
  }

  .cal-tooltip-event a:hover {
    text-decoration: underline;
  }

  .cal-tooltip-type {
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 2px;
  }
</style>

<script>
  import { initMiniCalendars } from '../../scripts/miniCalendar';

  // Initialize on page load and after Astro navigation
  document.addEventListener('DOMContentLoaded', initMiniCalendars);
  document.addEventListener('astro:page-load', initMiniCalendars);
</script>
