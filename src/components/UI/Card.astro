---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

export interface Props {
  title: string;
  image?: {
    src: string | ImageMetadata;
    alt: string;
  };
  href?: string;
  className?: string;
  imageLayout?: 'top' | 'background';
  [key: string]: any; // Allow arbitrary props like data-date
}

const { title, image, href, className = "", imageLayout = 'top', ...rest } = Astro.props;
const Element = href ? "a" : "div";

// Check if image.src is a string or ImageMetadata
const isStringImage = image && typeof image.src === 'string';
---

<Element
  href={href}
  aria-label={href ? title : undefined}
  class:list={[
    'card group overflow-hidden block h-full', // Added h-full for grid consistency
    { 'relative': imageLayout === 'background' },
    className
  ]}
  {...rest}
>
  {image && (
    <div class:list={[
      'overflow-hidden',
      { 'absolute inset-0': imageLayout === 'background' }
    ]}>
      {isStringImage ? (
        <img
          src={image.src as string}
          alt={image.alt}
          class:list={[
            "w-full object-cover object-center transition-transform duration-300 group-hover:scale-105",
            { 'h-full': imageLayout === 'background', 'h-48': imageLayout === 'top' }
          ]}
        />
      ) : (
        <Image
          src={image.src as ImageMetadata}
          alt={image.alt}
          class:list={[
            "w-full object-cover object-center transition-transform duration-300 group-hover:scale-105",
            { 'h-full': imageLayout === 'background', 'h-48': imageLayout === 'top' }
          ]}
          widths={[320, 640]}
          format="webp"
        />
      )}
    </div>
  )}

  <div class:list={[
    'p-5 flex flex-col flex-1',
    { 'relative': imageLayout === 'background' }
  ]}>
    <h3 class="mb-2 text-xl font-bold">{title}</h3>
    <div class="text-gray-700 flex-1">
      <slot />
    </div>
  </div>
</Element>
